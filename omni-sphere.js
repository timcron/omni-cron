function q(e){let t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function X(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function wt(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function $(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function K(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function Et(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function _t(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function Q(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function At(e,t){let r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return Math.sqrt(r*r+i*i+s*s)}function bt(e,t){let r=t[0]-e[0],i=t[1]-e[1],s=t[2]-e[2];return r*r+i*i+s*s}function J(e){let t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function zt(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function St(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function G(e,t){let r=t[0],i=t[1],s=t[2],n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function tt(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function et(e,t,r){let i=t[0],s=t[1],n=t[2],h=r[0],a=r[1],l=r[2];return e[0]=s*l-n*a,e[1]=n*h-i*l,e[2]=i*a-s*h,e}function Ct(e,t,r,i){let s=t[0],n=t[1],h=t[2];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=h+i*(r[2]-h),e}function Tt(e,t,r,i,s){let n=Math.exp(-i*s),h=t[0],a=t[1],l=t[2];return e[0]=r[0]+(h-r[0])*n,e[1]=r[1]+(a-r[1])*n,e[2]=r[2]+(l-r[2])*n,e}function Rt(e,t,r){let i=t[0],s=t[1],n=t[2],h=r[3]*i+r[7]*s+r[11]*n+r[15];return h=h||1,e[0]=(r[0]*i+r[4]*s+r[8]*n+r[12])/h,e[1]=(r[1]*i+r[5]*s+r[9]*n+r[13])/h,e[2]=(r[2]*i+r[6]*s+r[10]*n+r[14])/h,e}function Lt(e,t,r){let i=t[0],s=t[1],n=t[2],h=r[3]*i+r[7]*s+r[11]*n+r[15];return h=h||1,e[0]=(r[0]*i+r[4]*s+r[8]*n)/h,e[1]=(r[1]*i+r[5]*s+r[9]*n)/h,e[2]=(r[2]*i+r[6]*s+r[10]*n)/h,e}function Ot(e,t,r){let i=t[0],s=t[1],n=t[2];return e[0]=i*r[0]+s*r[3]+n*r[6],e[1]=i*r[1]+s*r[4]+n*r[7],e[2]=i*r[2]+s*r[5]+n*r[8],e}function Vt(e,t,r){let i=t[0],s=t[1],n=t[2],h=r[0],a=r[1],l=r[2],c=r[3],o=a*n-l*s,d=l*i-h*n,f=h*s-a*i,p=a*f-l*d,g=l*o-h*f,u=h*d-a*o,x=c*2;return o*=x,d*=x,f*=x,p*=2,g*=2,u*=2,e[0]=i+o+p,e[1]=s+d+g,e[2]=n+f+u,e}var It=(function(){let e=[0,0,0],t=[0,0,0];return function(r,i){X(e,r),X(t,i),G(e,e),G(t,t);let s=tt(e,t);return s>1?0:s<-1?Math.PI:Math.acos(s)}})();function qt(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var L=class e extends Array{constructor(t=0,r=t,i=t){return super(t,r,i),this}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}set(t,r=t,i=t){return t.length?this.copy(t):(wt(this,t,r,i),this)}copy(t){return X(this,t),this}add(t,r){return r?$(this,t,r):$(this,this,t),this}sub(t,r){return r?K(this,t,r):K(this,this,t),this}multiply(t){return t.length?Et(this,this,t):Q(this,this,t),this}divide(t){return t.length?_t(this,this,t):Q(this,this,1/t),this}inverse(t=this){return St(this,t),this}len(){return q(this)}distance(t){return t?At(this,t):q(this)}squaredLen(){return J(this)}squaredDistance(t){return t?bt(this,t):J(this)}negate(t=this){return zt(this,t),this}cross(t,r){return r?et(this,t,r):et(this,this,t),this}scale(t){return Q(this,this,t),this}normalize(){return G(this,this),this}dot(t){return tt(this,t)}equals(t){return qt(this,t)}applyMatrix3(t){return Ot(this,this,t),this}applyMatrix4(t){return Rt(this,this,t),this}scaleRotateMatrix4(t){return Lt(this,this,t),this}applyQuaternion(t){return Vt(this,this,t),this}angle(t){return It(this,t)}lerp(t,r){return Ct(this,this,t,r),this}smoothLerp(t,r,i){return Tt(this,this,t,r,i),this}clone(){return new e(this[0],this[1],this[2])}fromArray(t,r=0){return this[0]=t[r],this[1]=t[r+1],this[2]=t[r+2],this}toArray(t=[],r=0){return t[r]=this[0],t[r+1]=this[1],t[r+2]=this[2],t}transformDirection(t){let r=this[0],i=this[1],s=this[2];return this[0]=t[0]*r+t[4]*i+t[8]*s,this[1]=t[1]*r+t[5]*i+t[9]*s,this[2]=t[2]*r+t[6]*i+t[10]*s,this.normalize()}};var Bt=new L,Ne=1,Ue=1,Pt=!1,k=class{constructor(t,r={}){t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=r,this.id=Ne++,this.VAOs={},this.drawRange={start:0,count:0},this.instancedCount=0,this.gl.renderer.bindVertexArray(null),this.gl.renderer.currentGeometry=null,this.glState=this.gl.renderer.state;for(let i in r)this.addAttribute(i,r[i])}addAttribute(t,r){if(this.attributes[t]=r,r.id=Ue++,r.size=r.size||1,r.type=r.type||(r.data.constructor===Float32Array?this.gl.FLOAT:r.data.constructor===Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT),r.target=t==="index"?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,r.normalized=r.normalized||!1,r.stride=r.stride||0,r.offset=r.offset||0,r.count=r.count||(r.stride?r.data.byteLength/r.stride:r.data.length/r.size),r.divisor=r.instanced||0,r.needsUpdate=!1,r.usage=r.usage||this.gl.STATIC_DRAW,r.buffer||this.updateAttribute(r),r.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==r.count*r.divisor)return console.warn("geometry has multiple instanced buffers of different length"),this.instancedCount=Math.min(this.instancedCount,r.count*r.divisor);this.instancedCount=r.count*r.divisor}else t==="index"?this.drawRange.count=r.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,r.count))}updateAttribute(t){let r=!t.buffer;r&&(t.buffer=this.gl.createBuffer()),this.glState.boundBuffer!==t.buffer&&(this.gl.bindBuffer(t.target,t.buffer),this.glState.boundBuffer=t.buffer),r?this.gl.bufferData(t.target,t.data,t.usage):this.gl.bufferSubData(t.target,0,t.data),t.needsUpdate=!1}setIndex(t){this.addAttribute("index",t)}setDrawRange(t,r){this.drawRange.start=t,this.drawRange.count=r}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach((r,{name:i,type:s})=>{if(!this.attributes[i]){console.warn(`active attribute ${i} not being supplied`);return}let n=this.attributes[i];this.gl.bindBuffer(n.target,n.buffer),this.glState.boundBuffer=n.buffer;let h=1;s===35674&&(h=2),s===35675&&(h=3),s===35676&&(h=4);let a=n.size/h,l=h===1?0:h*h*4,c=h===1?0:h*4;for(let o=0;o<h;o++)this.gl.vertexAttribPointer(r+o,a,n.type,n.normalized,n.stride+l,n.offset+o*c),this.gl.enableVertexAttribArray(r+o),this.gl.renderer.vertexAttribDivisor(r+o,n.divisor)}),this.attributes.index&&this.